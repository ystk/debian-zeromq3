Description: Problem: unfinished message can be leaked by client pipe
Reviewed-By: Anton Gladky <gladk@debian.org>
Upstream: https://github.com/zeromq/libzmq/pull/3918
Last-Update: 2021-03-06

Index: zeromq3-4.0.5+dfsg/src/pipe.cpp
===================================================================
--- zeromq3-4.0.5+dfsg.orig/src/pipe.cpp	2021-03-20 16:33:19.754834173 +0100
+++ zeromq3-4.0.5+dfsg/src/pipe.cpp	2021-03-20 16:33:19.750834087 +0100
@@ -448,6 +448,7 @@
     if (state == active)
         state = delimiter_received;
     else {
+        rollback ();
         outpipe = NULL;
         send_pipe_term_ack (peer);
         state = term_ack_sent;
